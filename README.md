<div align="center">

# ğŸ¤– SparkToShip Bot

### *AI-Powered Proposal Generation Â· Image Creation Â· Client Intelligence â€” All from Telegram*

**[ğŸŒ sparktoship.com](https://www.sparktoship.com/)**

<br/>

[![Python](https://img.shields.io/badge/Python-3.11+-3776AB?style=for-the-badge&logo=python&logoColor=white)](https://python.org)
[![Flask](https://img.shields.io/badge/Flask-3.1+-000000?style=for-the-badge&logo=flask&logoColor=white)](https://flask.palletsprojects.com)
[![OpenAI](https://img.shields.io/badge/OpenAI-GPT%20Powered-412991?style=for-the-badge&logo=openai&logoColor=white)](https://openai.com)
[![Telegram](https://img.shields.io/badge/Telegram-Bot-2CA5E0?style=for-the-badge&logo=telegram&logoColor=white)](https://core.telegram.org/bots)
[![Docker](https://img.shields.io/badge/Docker-Ready-2496ED?style=for-the-badge&logo=docker&logoColor=white)](https://docker.com)
[![Status](https://img.shields.io/badge/Status-Active-22c55e?style=for-the-badge)](.)

<br/>

> ğŸ“„ **Generate professional technical proposals** from a simple brief â€” complete with pricing, roadmaps & architecture diagrams.
>
> ğŸ¨ **Create & edit AI images** from text prompts or reference photos â€” all without leaving Telegram.
>
> ğŸ”— **[www.sparktoship.com](https://www.sparktoship.com/)**

<br/>

[âœ¨ Features](#-features) Â· [ğŸ“„ Proposals](#-ai-generated-proposals) Â· [ğŸ¨ Image Generation](#-ai-image-generation) Â· [ğŸš€ Quick Start](#-quick-start) Â· [ğŸ¤– Bot Commands](#-bot-commands) Â· [ğŸ³ Deployment](#-deployment)

</div>

---

## ğŸŒŸ What is SparkToShip Bot?

The **SparkToShip Bot** is a multi-capability AI assistant built for technical agencies and freelancers, part of [**SparkToShip**](https://www.sparktoship.com/) â€” a Solution Architecture & Engineering studio. It lives entirely inside **Telegram** and handles two powerful workflows:

| Capability | What it does |
|---|---|
| ğŸ“„ **Proposal Generation** | Turns a client URL + brief into a fully-structured HTML proposal with pricing, roadmap, team plan, tech stack & architecture diagram â€” in minutes |
| ğŸ¨ **AI Image Generation** | Generates stunning images from text prompts, or edits/transforms your photos using reference images â€” powered by OpenAI's image model |

No complex tools, no dashboards to fight with â€” just a natural conversation in Telegram.

---

## âœ¨ Features

### ğŸ¤– Intelligent Telegram Bot
- Conversational, step-by-step **guided proposal flow** via Telegram
- **Quick-pitch mode**: start a proposal with a single command
- 30-minute session management with automatic cleanup
- Context-aware, MarkdownV2-formatted responses

### ğŸ“„ AI-Generated Proposals
- Powered by **OpenAI GPT models** for intelligent, context-aware content generation
- Tailored output based on project **scale** (Small / Medium / Enterprise)
- Generates: Executive Summary, Scope of Work, Delivery Roadmap, Team Structure, Pricing Breakdown, Tech Stack Recommendations, and Key Notes
- Automatic fallback from primary to secondary model on failures

### ğŸŒ Client Intelligence Engine
- **Auto-scrapes client websites** to extract: brand name, logo, and theme color
- Personalizes proposals using real client branding â€” `og:image`, favicon, and theme-color meta tags
- SSRF-protected: validates all URLs against private IPs before fetching

### ğŸ“Š Automated Architecture Diagrams
- Each proposal gets a **unique Mermaid.js system architecture diagram**, generated by AI
- Diagram is rendered server-side via **Puppeteer + `mmdc` CLI** and embedded as a PNG
- Graceful fallback to client-side Mermaid rendering if server-side rendering fails
- Intelligent Mermaid syntax cleanup and auto-quoting of complex node labels

### ğŸ¨ AI Image Generation
- Generate images from text prompts via the `/image` bot command
- Supports **reference image uploads** (up to 5 photos) for guided generation/editing
- AI-powered **prompt refinement** to enhance image quality automatically
- Images are compressed and optimized before sending via Telegram

### ğŸ—„ï¸ Web Dashboard
- Sleek, animated proposal dashboard at the root URL
- Lists all generated proposals with client name, project title, and creation timestamp
- Individual proposals served at unique URLs: `/proposal/<proposal-id>`
- Built with **TailwindCSS**, **Space Grotesk**, and **Inter** fonts

### ğŸ’° Smart Multi-Currency Pricing
- Supports **INR (â‚¹)** and **USD ($)** pricing
- Three project scales with realistic pricing bands:

  | Scale | INR Range | USD Range |
  |-------|-----------|-----------|
  | ğŸŒ± Small | â‚¹50K â€“ â‚¹2.5L | $1K â€“ $5K |
  | ğŸš€ Medium | â‚¹3L â€“ â‚¹10L | $5K â€“ $15K |
  | ğŸ¢ Enterprise | â‚¹12L â€“ â‚¹50L | $20K â€“ $100K+ |

### ğŸ“‚ Document Parsing
- Upload requirement documents via Telegram: `.pdf`, `.txt`, `.md`
- Share a **public link** (Google Drive, Dropbox, etc.) instead of uploading
- Extracted text is fed into the AI for deeply contextual proposal generation
- Supports PDF text extraction via **pdfplumber**

---

## ğŸ› ï¸ Tech Stack

| Layer | Technology |
|-------|------------|
| **Language** | Python 3.11+ |
| **Web Framework** | Flask + Gunicorn |
| **Bot Interface** | pyTelegramBotAPI |
| **AI / LLM** | OpenAI API (GPT models) |
| **Image Generation** | OpenAI `gpt-image-1.5` |
| **Diagramming** | Mermaid.js + Puppeteer (`mmdc` CLI) |
| **Frontend** | HTML5, TailwindCSS, Font Awesome |
| **PDF Parsing** | pdfplumber |
| **Image Processing** | Pillow |
| **Containerization** | Docker (multi-stage) |
| **Web Scraping** | BeautifulSoup4, Requests |
| **Deps Management** | `uv` (recommended) |

---

## ğŸš€ Quick Start

### Prerequisites

- **Python 3.11+**
- **Node.js 18+** & npm (for Mermaid diagram generation)
- A [Telegram Bot Token](https://t.me/botfather) from @BotFather
- An **OpenAI API Key**

### 1. Clone the Repository

```bash
git clone <repository-url>
cd Deal-Closer-Bot
```

### 2. Install Python Dependencies

```bash
# Recommended: using uv (fast, reliable)
uv sync

# Alternative: using pip
pip install beautifulsoup4 flask gunicorn openai pdfplumber Pillow python-dotenv pytelegrambotapi requests
```

### 3. Install Node.js Dependencies

```bash
# Required for server-side Mermaid diagram rendering
npm install
```

### 4. Configure Environment

Create a `.env` file in the project root:

```env
# â”€â”€ Required â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
AI_INTEGRATIONS_OPENAI_API_KEY=your_openai_api_key_here

# â”€â”€ Optional â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
AI_INTEGRATIONS_OPENAI_BASE_URL=https://api.openai.com/v1   # custom base URL if needed
APP_DOMAIN=your-domain.com                                   # for production URL links in bot messages
```

### 5. Run the Application

```bash
python main.py
```

The server starts at **http://localhost:8080** and the bot begins polling Telegram for messages.

---

## ğŸ¤– Bot Commands

Once your bot is running, these commands are available in Telegram:

| Command | Description |
|---------|-------------|
| `/start` or `/help` | Show the welcome message and list all available commands |
| `/pitch` | Start a **guided**, step-by-step proposal session |
| `/pitch <url> [Project Name]` | **Quick mode** â€” jump straight to AI generation with a client URL |
| `/proposals` | List the 10 most recently generated proposals with links |
| `/image` | Open an AI image generation session |
| `/cancel` | Cancel the current active session (pitch or image) |

### ğŸ“ Guided Proposal Flow (`/pitch`)

```
1. Client Name + Website URL  â†’  (e.g., "Acme Corp https://acme.com")
2. Project Brief              â†’  (100 words or less)
3. Currency                   â†’  INR or USD
4. Project Scale              â†’  Small / Medium / High
5. Requirement Document       â†’  Upload .pdf/.txt/.md, share a link, or skip
```

The bot then generates and sends you a link to the finished proposal.

### ğŸ¨ Image Flow (`/image`)

```
Option A â€” Text Only:
  Send a text prompt â†’ AI enhances it â†’ Image generated

Option B â€” Reference Photos + Caption:
  Send photo(s) with a caption â†’ AI edits/transforms using references

Option C â€” Photos First, Then Prompt:
  Send photo(s) â†’ Bot asks for prompt â†’ Image generated
```

---

## ğŸ—ï¸ Architecture

```
Deal-Closer-Bot/
â”œâ”€â”€ main.py                  # ğŸ§  App entry: Flask server + Telegram bot + session logic
â”œâ”€â”€ generator.py             # ğŸ“ Proposal engine: AI content, web scraping, Mermaid diagrams
â”œâ”€â”€ image_generator.py       # ğŸ¨ Image generation: text-to-image + reference-based editing
â”œâ”€â”€ document_parser.py       # ğŸ“‚ File parsing: PDF/TXT/MD upload + URL fetching
â”‚
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ proposal.html        # ğŸ“‹ Jinja2 HTML proposal template (TailwindCSS styled)
â”‚
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ proposals/           # ğŸ“ Generated proposals (one folder per proposal ID)
â”‚   â”‚   â”œâ”€â”€ <proposal-id>/
â”‚   â”‚   â”‚   â”œâ”€â”€ proposal.html
â”‚   â”‚   â”‚   â””â”€â”€ architecture.png
â”‚   â”‚   â””â”€â”€ index.json       # ğŸ—ƒï¸ Proposals index (newest-first)
â”‚   â””â”€â”€ generated/           # ğŸ–¼ï¸ AI-generated images
â”‚
â”œâ”€â”€ public/                  # Static assets (copied to /static/ at build time)
â”œâ”€â”€ Dockerfile               # ğŸ³ Multi-stage Docker build
â”œâ”€â”€ docker-compose.yml       # ğŸ³ Docker Compose configuration
â”œâ”€â”€ pyproject.toml           # ğŸ Python dependencies
â””â”€â”€ package.json             # ğŸ“¦ Node.js dependencies (Mermaid CLI)
```

### How a Proposal is Generated

```
User sends /pitch
      â”‚
      â–¼
Collect client info â†’ Scrape client website (name, logo, color)
      â”‚
      â–¼
AI generates structured JSON â†’  Executive Summary, Scope, Roadmap,
                                 Pricing, Team, Tech Stack, Mermaid Code
      â”‚
      â”œâ”€â”€â–º Server-side rendering: mmdc CLI â†’ architecture.png
      â”‚           (fallback: client-side Mermaid in browser)
      â”‚
      â–¼
Render proposal.html (Jinja2) â†’ Save to /static/proposals/<id>/
      â”‚
      â–¼
Update index.json â†’ Send proposal URL to Telegram user
```

---

## ğŸ³ Deployment

### Docker (Recommended)

The project uses a **multi-stage Docker build** â€” Node.js in Stage 1 for Mermaid, Python in Stage 2 for the app.

```bash
# Build the image
docker build -t deal-closer-bot .

# Run with environment variables
docker run -d \
  -p 8080:8080 \
  -e TELEGRAM_BOT_TOKEN=your_token \
  -e AI_INTEGRATIONS_OPENAI_API_KEY=your_key \
  -e APP_DOMAIN=your-domain.com \
  --name deal-closer-bot \
  deal-closer-bot
```

### Docker Compose

```bash
# Start with docker-compose
docker-compose up -d

# View logs
docker-compose logs -f
```

Edit `docker-compose.yml` to set your environment variables before running.

### VPS with Nginx (Production)

For production deployment behind Nginx (SSL + reverse proxy):

```nginx
server {
    listen 443 ssl;
    server_name your-domain.com;

    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_read_timeout 120s;
    }
}
```

> ğŸ’¡ **Tip**: Use `certbot` to obtain free SSL certificates from Let's Encrypt.

---

## ğŸ“¡ API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/` | Proposal dashboard (lists all proposals) |
| `GET` | `/proposal` | Redirects to dashboard |
| `GET` | `/proposal/<id>` | View a specific proposal by its unique ID |
| `GET` | `/image/<id>` | Serve a generated AI image by its unique ID |
| `GET` | `/static/<path>` | Serve static assets (logos, proposal images, etc.) |

---

## âš™ï¸ Configuration Reference

| Variable | Required | Description |
|----------|----------|-------------|
| `TELEGRAM_BOT_TOKEN` | âœ… Yes | Your Telegram bot token from [@BotFather](https://t.me/botfather) |
| `AI_INTEGRATIONS_OPENAI_API_KEY` | âœ… Yes | OpenAI API key for GPT and image generation |
| `AI_INTEGRATIONS_OPENAI_BASE_URL` | âŒ Optional | Custom OpenAI-compatible API base URL |
| `APP_DOMAIN` | âŒ Recommended | Your server's domain for generating proposal links in bot messages |

---

## ğŸ”’ Security

- **SSRF Protection**: All client URLs are validated against private, loopback, reserved, and link-local IP ranges before fetching.
- **File validation**: Only `.pdf`, `.txt`, and `.md` files are accepted; maximum size is 5MB per upload.
- **Image validation**: Reference images are capped at 4MB each, up to 5 images per session.
- **Session isolation**: Each Telegram user gets an isolated session with a 30-minute inactivity timeout.

---

## ğŸ“‹ Requirements

```toml
# Python (pyproject.toml)
beautifulsoup4 >= 4.14.3
flask >= 3.1.2
gunicorn >= 25.1.0
openai >= 2.21.0
pdfplumber >= 0.11.0
Pillow >= 10.0.0
python-dotenv >= 1.0.0
pytelegrambotapi >= 4.31.0
requests >= 2.32.5
```

```json
// Node.js (package.json)
"@mermaid-js/mermaid-cli": "latest"
```

---

## ğŸ¤ Contributing

Contributions are welcome! Here's how to get started:

1. **Fork** the repository
2. **Create** a feature branch: `git checkout -b feature/amazing-feature`
3. **Commit** your changes: `git commit -m 'Add amazing feature'`
4. **Push** to the branch: `git push origin feature/amazing-feature`
5. **Open** a Pull Request

---

## ğŸ“„ License

This project is licensed under the **MIT License**.

---

<div align="center">

Built with â¤ï¸ by [**SparkToShip**](https://www.sparktoship.com/) Â· *Solution Architecture & Engineering*

</div>
